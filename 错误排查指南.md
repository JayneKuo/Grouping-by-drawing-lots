# 批量添加404错误排查指南

## 🔍 问题现象
批量添加选手时出现404错误

## ✅ 检查清单

### 1. 后端服务器是否运行？
**检查方法：**
- 打开浏览器访问：http://localhost:3000/api/health
- 应该返回：`{"status":"ok","message":"服务器运行正常（简化版，无需MySQL）"}`

**如果没有运行：**
```bash
cd backend
node server-simple.js
```

### 2. 后端路由是否正确注册？
**检查方法：**
- 查看后端控制台启动日志
- 应该看到：
  ```
  📋 已注册的路由：
     POST /api/tournaments/:id/players/batch (批量导入)
     POST /api/tournaments/:id/players (单个添加)
  ```

**如果没有看到：**
- 后端服务器需要重启
- 检查 `backend/server-simple.js` 文件第142行是否有批量导入路由

### 3. Vite代理是否配置正确？
**检查方法：**
- 查看 `vite.config.js` 文件
- 应该看到：
  ```javascript
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true
    }
  }
  ```

### 4. 前端请求路径是否正确？
**检查方法：**
- 打开浏览器开发者工具（F12）
- 查看 Network 标签
- 请求URL应该是：`/api/tournaments/1/players/batch`
- 不应该直接是：`http://localhost:8081/api/...`（这说明代理没工作）

### 5. 后端是否收到请求？
**检查方法：**
- 查看后端控制台
- 点击批量添加时，应该看到：
  ```
  📥 [批量导入] 收到请求 - ID: 1
  📥 [批量导入] 请求体: {...}
  ```

**如果没有看到：**
- 说明请求没有到达后端
- 可能是Vite代理问题或前端请求路径错误

## 🔧 解决方案

### 方案1：重启所有服务器
```bash
# 双击运行
强制重启所有服务器.bat
```

### 方案2：手动重启
1. 停止所有Node进程（Ctrl+C）
2. 启动后端：
   ```bash
   cd backend
   node server-simple.js
   ```
3. 启动前端（新终端）：
   ```bash
   npm run dev
   ```

### 方案3：检查Vite代理
如果前端运行在8081端口，确保：
1. 后端在3000端口运行
2. `vite.config.js` 中的代理target是 `http://localhost:3000`

### 方案4：直接测试后端API
使用Postman或curl测试：
```bash
curl -X POST http://localhost:3000/api/tournaments/1/players/batch \
  -H "Content-Type: application/json" \
  -d "{\"players\":[{\"name\":\"测试\"}]}"
```

如果这个请求成功，说明后端正常，问题在前端或代理。

## 📝 调试步骤

1. **打开浏览器开发者工具（F12）**
2. **切换到 Network 标签**
3. **点击批量添加按钮**
4. **查看请求详情：**
   - Request URL: 应该是 `/api/tournaments/1/players/batch`
   - Status Code: 如果是404，查看Response内容
   - 如果是HTML响应，说明Vite代理没有工作

5. **查看后端控制台：**
   - 是否有 "📥 [批量导入] 收到请求" 日志
   - 如果没有，说明请求没有到达后端

6. **查看浏览器控制台：**
   - 是否有 "📤 [请求]" 日志
   - 是否有错误信息

## 🐛 常见错误

### 错误1：Cannot GET /api/tournaments/1/players/batch
**原因：** 这是GET请求，但路由是POST
**解决：** 检查前端代码，确保使用POST方法

### 错误2：404 HTML响应
**原因：** Vite代理没有工作，请求被前端服务器处理
**解决：** 
- 重启前端服务器
- 检查 `vite.config.js` 配置
- 确保后端服务器在3000端口运行

### 错误3：后端没有收到请求
**原因：** 请求没有通过代理到达后端
**解决：**
- 检查Vite代理配置
- 检查后端服务器是否运行
- 检查端口是否正确

## 💡 提示

- 修改后端代码后**必须重启后端服务器**
- 修改前端代码后**必须重启前端服务器**（或等待热更新）
- 修改 `vite.config.js` 后**必须重启前端服务器**

## 📞 如果还是不行

请提供以下信息：
1. 后端控制台的完整输出（特别是启动时的路由列表）
2. 浏览器 Network 标签中的请求详情（截图）
3. 浏览器 Console 标签中的错误信息（截图）
4. 后端控制台在点击批量添加时是否有任何输出

