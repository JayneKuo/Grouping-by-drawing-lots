# 本地测试环境使用说明

## 🎯 目的

在本地完整测试应用功能，确认无误后再部署到 Vercel，避免反复部署调试。

## 🚀 快速启动

### 方法1：一键启动（推荐）

双击运行 `启动本地测试.bat`，会自动：
1. 检查并安装依赖
2. 启动本地API服务器（端口3001）
3. 启动前端开发服务器（端口8080）

### 方法2：手动启动

**步骤1：启动本地API服务器**

```bash
cd backend
node server-local-api.js
```

**步骤2：启动前端开发服务器**

```bash
npm run dev
```

## 📁 数据存储

- **本地数据文件**：`backend/local-data.json`
- **格式**：与 Vercel KV 存储格式完全一致
- **说明**：所有数据操作都会保存到这个文件，可以随时查看和修改

## 🔧 工作原理

1. **本地API服务器** (`backend/server-local-api.js`)
   - 模拟 Vercel Serverless Function `/api/data`
   - 使用 JSON 文件存储数据（模拟 Redis）
   - 监听端口：3001

2. **前端代理** (`vite.config.js`)
   - Vite 自动将 `/api/*` 请求代理到 `http://localhost:3001`
   - 本地开发时自动启用代理

3. **数据格式**
   - 与生产环境完全一致
   - 可以无缝切换到 Vercel

## ✅ 测试流程

1. **启动本地环境**
   ```
   双击运行：启动本地测试.bat
   ```

2. **访问应用**
   ```
   浏览器打开：http://localhost:8080
   ```

3. **测试功能**
   - ✅ 登录/注册
   - ✅ 创建比赛
   - ✅ 添加选手
   - ✅ 开始比赛
   - ✅ 计分功能
   - ✅ 数据同步

4. **查看数据**
   ```
   打开文件：backend/local-data.json
   可以看到所有保存的数据
   ```

5. **确认无误后部署**
   ```bash
   git add .
   git commit -m "功能测试完成"
   git push
   ```
   Vercel 会自动部署

## 🔍 调试技巧

### 查看API请求日志

- **前端控制台**：打开浏览器 F12，查看 Network 标签
- **API服务器日志**：查看启动API服务器的命令行窗口

### 查看数据文件

```bash
# Windows
type backend\local-data.json

# Mac/Linux
cat backend/local-data.json
```

### 重置数据

删除 `backend/local-data.json`，重启API服务器会自动创建新文件。

## ⚠️ 注意事项

1. **端口占用**
   - 确保 3001 和 8080 端口未被占用
   - 如果被占用，修改 `backend/server-local-api.js` 和 `vite.config.js` 中的端口

2. **数据隔离**
   - 本地测试数据不会影响生产环境
   - 生产环境数据不会影响本地测试

3. **部署前检查**
   - 确保所有功能在本地测试通过
   - 检查 `backend/local-data.json` 中的数据格式是否正确

## 🆚 本地 vs 生产环境

| 项目 | 本地测试 | 生产环境（Vercel） |
|------|---------|-------------------|
| API服务器 | Node.js Express | Vercel Serverless Functions |
| 数据存储 | JSON文件 | Vercel KV (Redis) |
| 端口 | 3001 | 自动分配 |
| 前端 | localhost:8080 | 你的域名 |
| 数据文件 | backend/local-data.json | Vercel KV数据库 |

## 🐛 常见问题

### Q: 启动后无法访问？
A: 检查端口是否被占用，或查看命令行窗口的错误信息。

### Q: 数据没有保存？
A: 检查 `backend/local-data.json` 文件权限，确保可以写入。

### Q: API请求失败？
A: 确保本地API服务器已启动（端口3001），检查 Vite 代理配置。

### Q: 如何切换到生产环境？
A: 代码会自动检测环境，本地开发使用本地API，部署后使用 Vercel API。

## 📝 下一步

测试完成后：
1. 提交代码到 GitHub
2. Vercel 会自动部署
3. 访问生产环境验证

---

**提示**：本地测试环境与生产环境完全一致，本地测试通过后，生产环境也应该正常工作！

