# 移动端问题排查说明

## 问题1：手机上同步不到数据

### 可能原因和解决方案

#### 1. Firebase权限配置问题
**检查步骤：**
- 打开浏览器开发者工具（F12）
- 查看Console（控制台）是否有错误信息
- 如果看到权限错误（permission-denied），需要检查Firebase权限配置

**解决方法：**
1. 登录 [Firebase控制台](https://console.firebase.google.com/)
2. 选择项目：`tennis-tournament-f2e6e`
3. 进入 **Firestore Database** → **规则**
4. 确保规则如下：
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /tennis_tournaments/{document=**} {
      allow read, write: if true;
    }
  }
}
```
5. 点击 **发布**

#### 2. 网络连接问题
**检查步骤：**
- 确保手机已连接网络（WiFi或移动数据）
- 尝试访问其他网站确认网络正常
- 检查是否有防火墙或代理阻止Firebase连接

**解决方法：**
- 切换到其他网络尝试
- 关闭VPN（如果开启）
- 清除浏览器缓存后重试

#### 3. 浏览器缓存问题
**解决方法：**
- **Chrome/Edge（移动端）：**
  1. 打开浏览器设置
  2. 隐私和安全 → 清除浏览数据
  3. 选择"缓存的图片和文件"
  4. 点击"清除数据"
  5. 重新打开应用

- **Safari（iOS）：**
  1. 设置 → Safari
  2. 清除历史记录和网站数据
  3. 重新打开应用

#### 4. Firebase配置问题
**检查步骤：**
- 打开应用后，查看浏览器控制台
- 查找是否有Firebase初始化错误

**解决方法：**
- 如果看到"Firebase未配置"提示，说明Firebase配置丢失
- 需要重新配置Firebase（参考 `Firebase配置说明.md`）

#### 5. 手动同步测试
**测试步骤：**
1. 打开"比赛列表"页面
2. 点击右上角的同步状态指示器
3. 观察同步状态变化：
   - 如果显示"同步中..."然后变为"已同步" → 同步成功
   - 如果显示"同步失败" → 查看错误信息

**如果同步失败：**
- 查看浏览器控制台的错误信息
- 截图错误信息，便于排查问题

---

## 问题2：进入比赛详情显示的不是点击的对阵选手信息

### 已修复的问题

#### 1. 路由参数传递问题
**修复内容：**
- 从"比赛详情"页面跳转时，现在会传递`tournament_id`参数
- 确保加载正确的比赛数据

#### 2. 路由变化监听
**修复内容：**
- 添加了路由参数变化监听
- 当路由变化时，自动重新加载比赛数据
- 解决了移动端跳转后数据不更新的问题

### 排查步骤

#### 1. 检查URL参数
**步骤：**
1. 点击比赛后，查看浏览器地址栏
2. URL应该是：`/match/123?tournament=456`
   - `123`是比赛ID
   - `456`是比赛所属的tournament ID

**如果URL中没有`tournament`参数：**
- 可能是从旧版本跳转过来的
- 刷新页面后重试

#### 2. 查看控制台日志
**步骤：**
1. 打开浏览器开发者工具（F12）
2. 切换到Console（控制台）
3. 点击比赛，查看日志输出：
   - `🔍 开始加载比赛，路由参数ID: ...`
   - `✅ 找到比赛: ...` 或 `❌ 未找到比赛`

**如果看到"未找到比赛"：**
- 检查比赛ID是否正确
- 检查tournament ID是否正确
- 查看是否有多个tournament包含相同ID的比赛

#### 3. 检查数据加载
**步骤：**
1. 在控制台查看日志：
   - `📋 加载的比赛数据: ...`
   - 确认显示的选手信息是否正确

**如果显示错误的选手信息：**
- 可能是数据缓存问题
- 清除浏览器缓存后重试
- 或者手动同步数据

---

## 通用排查方法

### 1. 清除缓存
**所有浏览器：**
1. 清除浏览器缓存
2. 强制刷新页面（Ctrl+Shift+R 或 Cmd+Shift+R）
3. 重新登录

### 2. 查看控制台日志
**步骤：**
1. 打开开发者工具（F12）
2. 切换到Console（控制台）
3. 查看是否有错误信息
4. 查看同步和数据加载的日志

### 3. 测试同步功能
**步骤：**
1. 在电脑上创建一个测试比赛
2. 点击同步状态指示器，手动同步
3. 在手机上刷新页面
4. 查看是否能看到新创建的比赛

### 4. 检查网络连接
**步骤：**
1. 确保手机和电脑连接到同一网络（或都能访问互联网）
2. 尝试访问其他网站确认网络正常
3. 检查是否有防火墙阻止Firebase连接

---

## 如果问题仍然存在

### 收集信息
1. **浏览器控制台日志：**
   - 截图或复制所有错误信息
   - 特别关注Firebase相关的错误

2. **网络请求：**
   - 打开开发者工具 → Network（网络）
   - 查看Firebase请求是否成功
   - 查看请求的响应内容

3. **设备信息：**
   - 手机型号和操作系统版本
   - 浏览器类型和版本
   - 网络环境（WiFi/移动数据）

4. **操作步骤：**
   - 详细描述操作步骤
   - 在哪个页面点击了什么
   - 期望看到什么，实际看到什么

### 临时解决方案

如果同步问题无法解决，可以：
1. **使用手动同步：**
   - 每次操作后，点击同步状态指示器手动同步
   - 确保数据已保存到云端

2. **检查本地数据：**
   - 数据会先保存到本地（localStorage）
   - 即使同步失败，本地数据也不会丢失
   - 刷新页面后，本地数据仍然存在

3. **多设备测试：**
   - 在同一设备上测试，确认功能正常
   - 如果同一设备正常，可能是网络或权限问题

---

## 联系支持

如果以上方法都无法解决问题，请提供：
1. 浏览器控制台日志截图
2. 网络请求截图
3. 详细的问题描述
4. 操作步骤和期望结果

