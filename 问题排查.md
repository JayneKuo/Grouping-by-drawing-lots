# 问题排查指南

## 🔍 无法预览/运行的主要原因

### 1. **浏览器安全限制（最常见）**

**问题：** 直接双击打开HTML文件时，浏览器可能阻止加载本地JavaScript文件。

**解决方案：**
- ✅ **使用本地服务器**（推荐）
  ```bash
  # Python方式
  python -m http.server 8000
  # 然后访问 http://localhost:8000
  ```
  
- ✅ **使用VS Code Live Server**
  - 安装扩展：Live Server
  - 右键 index.html → Open with Live Server

- ✅ **使用Node.js**
  ```bash
  npx http-server
  ```

### 2. **文件路径错误**

**检查清单：**
```
抽签分组/
├── index.html          ✅ 必须存在
├── style.css           ✅ 必须存在
├── test-run.html       ✅ 测试工具
└── js/                 ✅ 文件夹必须存在
    ├── config.js       ✅
    ├── utils.js        ✅
    ├── cache.js        ✅
    ├── auth.js         ✅
    ├── scoring.js      ✅
    ├── ranking.js       ✅
    └── app.js          ✅
```

### 3. **模块加载顺序错误**

**问题：** JavaScript模块必须按正确顺序加载。

**已修复：** index.html中的script标签顺序已正确：
```html
<script src="js/config.js"></script>    <!-- 1. 配置 -->
<script src="js/utils.js"></script>     <!-- 2. 工具 -->
<script src="js/cache.js"></script>     <!-- 3. 缓存 -->
<script src="js/auth.js"></script>      <!-- 4. 认证 -->
<script src="js/scoring.js"></script>   <!-- 5. 计分 -->
<script src="js/ranking.js"></script>   <!-- 6. 排名 -->
<script src="js/app.js"></script>       <!-- 7. 主应用 -->
```

### 4. **全局函数未定义**

**问题：** HTML中的onclick事件调用的函数未定义。

**已修复：** 已在app.js中添加全局函数：
- ✅ `window.recordPoint(player, type)` - 记录得分
- ✅ `window.recordSpecial(action)` - 特殊操作
- ✅ `window.App` - 主应用对象

### 5. **浏览器兼容性**

**支持的浏览器：**
- ✅ Chrome 60+
- ✅ Firefox 55+
- ✅ Edge 79+
- ✅ Safari 11+

**不支持的浏览器：**
- ❌ IE 11及以下

## 🛠️ 诊断步骤

### 第一步：打开测试页面

1. 使用本地服务器运行 `test-run.html`
2. 查看页面显示的测试结果
3. 如果所有模块显示 ✅，说明文件加载正常

### 第二步：检查浏览器控制台

1. 按 **F12** 打开开发者工具
2. 查看 **Console** 标签页
3. 查看是否有红色错误信息

**常见错误：**

```
❌ Failed to load resource: net::ERR_FILE_NOT_FOUND
→ 文件路径错误，检查文件是否存在

❌ CONFIG is not defined
→ config.js未加载，检查script标签顺序

❌ Cannot read property 'xxx' of undefined
→ 某个模块未正确初始化

❌ CORS policy
→ 必须使用本地服务器，不能直接打开文件
```

### 第三步：检查网络请求

1. 打开开发者工具（F12）
2. 切换到 **Network** 标签页
3. 刷新页面
4. 查看哪些文件加载失败（红色）

## 🔧 快速修复

### 如果所有文件都存在但还是无法运行：

1. **清除浏览器缓存**
   - Ctrl + Shift + Delete
   - 清除缓存和Cookie

2. **强制刷新**
   - Ctrl + F5（Windows）
   - Cmd + Shift + R（Mac）

3. **尝试不同浏览器**
   - Chrome
   - Firefox
   - Edge

4. **检查文件编码**
   - 确保所有文件都是 UTF-8 编码
   - 不要使用BOM

## 📋 完整检查清单

- [ ] 所有文件都在正确位置
- [ ] 使用本地服务器运行（不是直接打开）
- [ ] 浏览器控制台没有错误
- [ ] test-run.html 显示所有模块加载成功
- [ ] 浏览器版本支持（Chrome 60+）
- [ ] 文件编码是 UTF-8
- [ ] 没有语法错误（检查控制台）

## 🆘 如果还是无法运行

请提供以下信息：

1. **浏览器信息**
   - 浏览器名称和版本
   - 操作系统版本

2. **错误信息**
   - 浏览器控制台（F12）的完整错误信息
   - test-run.html 的测试结果

3. **运行方式**
   - 是否使用本地服务器？
   - 使用的服务器类型（Python/Node.js/Live Server）

4. **文件结构**
   - 所有文件是否都在正确位置？
   - 文件夹名称是否正确？

## ✅ 已修复的问题

1. ✅ 添加了全局函数 `recordPoint` 和 `recordSpecial`
2. ✅ 添加了 `playSound` 函数到 utils.js
3. ✅ 完善了 `openScoreModal` 函数
4. ✅ 添加了 `updatePointDisplay` 和 `addPointHistory` 方法
5. ✅ 修复了模块加载顺序
6. ✅ 添加了错误处理和日志输出

## 🎯 下一步

如果所有检查都通过，应用应该可以正常运行：

1. 打开 `index.html`（使用本地服务器）
2. 点击"立即登录"
3. 使用测试账号登录：`admin` / `admin123`
4. 创建新比赛
5. 添加选手
6. 开始分组和录入比分

